name: CI
on:
  push:
  pull_request:
jobs:
  psqa:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup PowerShell
        shell: pwsh
        run: Write-Host "PowerShell is ready"
      - name: Install tooling
        shell: pwsh
        run: |
          Set-PSRepository PSGallery -InstallationPolicy Trusted
          Install-Module PSScriptAnalyzer -Scope CurrentUser -Force
          Install-Module Pester -Scope CurrentUser -Force
      - name: Lint
        shell: pwsh
        run: |
          Invoke-ScriptAnalyzer -Path . -Settings ./.config/PSScriptAnalyzerSettings.psd1 -Recurse -Severity Warning,Error
      - name: Tests
        shell: pwsh
        run: |
          Invoke-Pester -Path tests -CI -Output Detailed